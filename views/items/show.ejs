<%- include('../partials/header') %>



<h4>Platform: <%= item.platform %> </h4>
<h4>Condition: <%= item.itemCondition[0].toUpperCase() + item.itemCondition.slice(1,) %> </h4>
<% if(user) {%> 
    <% if(user._id.equals(item.seller._id)) {%>
        <h4>Seller: <a href="/users"><%= item.seller.name %></a></h4>
    <% } else { %>  
        <h4>Seller: <a href="/users/<%= item.seller._id %>"><%= item.seller.name %></a></h4>
    <% } %> 
<% } else {%>
    <h4>Seller: <a href="/users/<%= item.seller._id %>"><%= item.seller.name %></a></h4>
<% } %>  
<h4>Game Reviews:</h4>
<% item.reviews.forEach(r => {%>
  <h3><%= r.review %> by <%= r.createdBy.name %> </h3>
<% }) %>  

<h3>Seller Reviews:</h3>
<% sellerReviews.forEach(s => {%>
    <h4><%= s.review %> by <%= s.createdBy.name %>  </h4> 

<% }) %> 
<h4>Buy it Now!: $<%= item.price %> </h4> 

 

<% let timeDiff = ((Date.now()) - item.auctionStart.getTime())/(3600000)  %> 
<div><% timeDiff = 5 - timeDiff %></div>

<% let hr = Math.floor(timeDiff) %> 
<% let min = (timeDiff - Math.floor(timeDiff))*60 %>
<% let sec = (min - Math.floor(min)) * 60 %> 

 




<% let cartCheck = false
if(user.cart.length !== 0){
  user.cart.forEach(i=>{
 
    if(i.itemId.equals(item._id)) cartCheck = true
    else cartCheck = false
  })
}
 %> 


  <% if(user ){%> 
<form action="/carts/<%= user._id %>" method="POST">
  
  <input type="text" name="itemId" value="<%= item._id %>" hidden>
  <% if(!(user._id.equals(item.seller._id))) {%> 
    <% if(!cartCheck){ %> 
       <button class="btn btn-primary btn-sm" type="submit">Add to Cart</button>
    <% } else {%>
      
    <% } %>  
  <% } %> 
</form>
<% }else { %>
  <a href="/auth/google"><button class="btn btn-primary btn-sm" type="submit">Login to Buy</button></a>
<% } %>  

<% if(item.isAuction){%>
  <h4>Current Bid: $<%= item.bid %></h4> 
  <% if(timeDiff > 0){ %> 
    <div>Time Remaining: <Span id='item-page-time'><%= hr %>H<% if (min < 10) { %>0<%= Math.floor(min) %>M<% }else{ %><%= Math.floor(min) %>M<% } %> 
      
    </Span></div> 
  <% } %>
  </h4>
  <% if(user) {%> 
    <% if(!(user._id.equals(item.seller._id)) && !(timeDiff < 0)) {%> 
      <a href="/items/auctions/<%= item._id %>/new"><button class="btn btn-primary btn-sm" >Place a Bid</button></a>
      
    <% } else if(!(user._id.equals(item.seller._id)) && timeDiff < 0){%>
      <h3> Auction has expried </h3>
    <% } %>  
  <% }else{%>
    <a href="/auth/google"><button class="btn btn-primary btn-sm" >Login to Bid</button></a>
  <% } %>  
<% } %>  


  <div class="container">

    <div class="row">

      <!-- /.col-lg-3 -->

      <div class="col-lg-12 .parentContainer">

        <div class="card mt-4">
          <div class="card" >
            <div class="row no-gutters">
                <div class="col-lg-5">
                    <img class="card-img" src="<%= item.picture %> " style="height: 100%" alt="Suresh Dasari Card">
                </div>
                <div class="col-lg-7">
                    <div class="card-body">
                        <h5 class="card-title"><%= item.itemName%> </h5>
                        <p class="card-text">  <p class="card-text"> <ul class="list-group list-group-flush">
                          <li class="list-group-item">Platform: <%= item.platform %> </li>
                          <li class="list-group-item">Condition: </li>
                          <li class="list-group-item">Seller</li>
                          <li class="list-group-item">Buy it Now:</li>
                          <li class="list-group-item">Current Bid:</li>
                          <li class="list-group-item">Time Left:</li>
                          
                        </ul></p></p>
                        <a href="#" class="btn btn-primary">View Profile</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.card -->

        <div class="card card-outline-secondary my-4">
          <div class="card-header">
            Product Reviews
          </div>
          <div class="card-body">
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Omnis et enim aperiam inventore, similique necessitatibus neque non! Doloribus, modi sapiente laboriosam aperiam fugiat laborum. Sequi mollitia, necessitatibus quae sint natus.</p>
            <small class="text-muted">Posted by Anonymous on 3/1/17</small>
            <hr>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Omnis et enim aperiam inventore, similique necessitatibus neque non! Doloribus, modi sapiente laboriosam aperiam fugiat laborum. Sequi mollitia, necessitatibus quae sint natus.</p>
            <small class="text-muted">Posted by Anonymous on 3/1/17</small>
            <hr>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Omnis et enim aperiam inventore, similique necessitatibus neque non! Doloribus, modi sapiente laboriosam aperiam fugiat laborum. Sequi mollitia, necessitatibus quae sint natus.</p>
            <small class="text-muted">Posted by Anonymous on 3/1/17</small>
            <hr>
            <a href="#" class="btn btn-success">Leave a Review</a>
          </div>
        </div>
        <!-- /.card -->

      </div>
      <!-- /.col-lg-9 -->

    </div>

  </div>
  <!-- /.container -->
  <div class="form-container">
    <form method="POST" action="/items/<%= item._id %>/reviews">
      <div class="form-group">
        
      <div class="form-group">
        <label for="exampleFormControlTextarea1">Write a review about this game:</label>
        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" name="review"></textarea>
      </div>
      <button class="btn btn-primary" type="submit">Post Review</button>
    </form>
  </div>

  <script>
   
  </script>
<%- include('../partials/footer') %>